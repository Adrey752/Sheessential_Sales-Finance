@model ExpensesViewModel;

@{
    ViewData["Title"] = "Expense Page";
}

<link href="~/css/output.css" rel="stylesheet" />

<div class="p-10 bg-gray-50 min-h-screen">
    <!-- HEADER -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Expense Management</h1>
        <!-- ✅ Button to open modal -->
        <button id="openModalBtn" class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition">
            + Add New Purchase
        </button>
    </div>

    <!-- SUMMARY CARDS -->
    <div class="grid grid-cols-4 gap-6 mb-10">
        <div class="bg-white p-6 rounded-2xl shadow-md">
            <p class="text-gray-500">Total Expenses</p>
            <h2 class="text-2xl font-bold text-gray-800">₱@ViewBag.TotalExpenses.ToString("N2")</h2>
        </div>
        <div class="bg-white p-6 rounded-2xl shadow-md">
            <p class="text-gray-500">Pending Bills</p>
            <h2 class="text-2xl font-bold text-gray-800">₱@ViewBag.PendingBills.ToString("N2")</h2>
        </div>
        <div class="bg-white p-6 rounded-2xl shadow-md">
            <p class="text-gray-500">Paid Bills</p>
            <h2 class="text-2xl font-bold text-gray-800">₱@ViewBag.PaidBills.ToString("N2")</h2>
        </div>
        <div class="bg-white p-6 rounded-2xl shadow-md">
            <p class="text-gray-500">Purchases This Month</p>
            <h2 class="text-2xl font-bold text-gray-800">@ViewBag.PurchasesThisMonth</h2>
        </div>
    </div>

    <!-- PURCHASE TABLE -->

    <div class="p-6">
        <h1 class="text-2xl font-bold mb-6">Vendors</h1>

        @if (!Model.Vendors.Any())
        {
            <p class="text-gray-500">No vendors found.</p>
        }
        else
        {
            <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="p-3 text-left">Vendor ID</th>
                        <th class="p-3 text-left">Name</th>
                        <th class="p-3 text-left">Company</th>
                        <th class="p-3 text-left">Contact</th>
                        <th class="p-3 text-left">Email</th>
                        <th class="p-3 text-left">Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var vendor in Model.Vendors)
                    {
                        <tr class="border-t hover:bg-gray-50">
                            <td class="p-3">@vendor.VendorId</td>
                            <td class="p-3">@vendor.VendorName</td>
                            <td class="p-3">@vendor.CompanyName</td>
                            <td class="p-3">@vendor.ContactPerson</td>
                            <td class="p-3">@vendor.Email</td>
                            <td class="p-3">
                                <span class="@(vendor.Status == "Active" ? "text-green-600" : "text-red-600")">
                                    @vendor.Status
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
</div>

<!-- ✅ MODAL (Hidden by default) -->
<div id="purchaseModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white w-11/12 md:w-3/4 lg:w-2/3 rounded-xl shadow-xl p-6 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center border-b pb-3 mb-4">
            <h2 class="text-2xl font-bold text-gray-800">New Purchase</h2>
            <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>

        <!-- MODAL FORM -->
        <form>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="font-semibold text-gray-700">Vendor</label>
                    <select class="form-select w-full border rounded-lg p-2">
                        <option disabled selected>-- Select Vendor --</option>
                        <option>Glow Essentials</option>
                        <option>Skin Haven</option>
                        <option>ABC Supplies</option>
                    </select>
                </div>
                <div>
                    <label class="font-semibold text-gray-700">Purchase Date</label>
                    <input type="date" class="w-full border rounded-lg p-2" />
                </div>
                <div>
                    <label class="font-semibold text-gray-700">Due Date</label>
                    <input type="date" class="w-full border rounded-lg p-2" />
                </div>
            </div>

            <!-- ITEM DETAILS -->
            <div class="mb-4">
                <label class="font-semibold text-gray-700 block mb-2">Item Details</label>
                <table class="w-full border border-gray-200 rounded-lg" id="itemTable">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="p-2 text-left">Item Name</th>
                            <th class="p-2 text-left">Quantity</th>
                            <th class="p-2 text-left">Unit Price (₱)</th>
                            <th class="p-2 text-left">Subtotal (₱)</th>
                            <th class="p-2"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" class="w-full border p-1 rounded" placeholder="Item name" /></td>
                            <td><input type="number" class="w-full border p-1 rounded" min="1" value="1" /></td>
                            <td><input type="number" class="w-full border p-1 rounded" min="0" value="0" /></td>
                            <td><input type="text" class="w-full border p-1 rounded bg-gray-50" readonly value="0.00" /></td>
                            <td><button type="button" class="text-red-500 hover:text-red-700 text-lg remove-row">✖</button></td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" id="addRow" class="mt-2 text-blue-600 hover:underline">+ Add Row</button>
            </div>

            <!-- TAX & NOTES -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="font-semibold text-gray-700">Tax / Discount (₱)</label>
                    <input type="number" class="w-full border rounded-lg p-2" placeholder="0.00" />
                </div>
                <div>
                    <label class="font-semibold text-gray-700">Notes / Remarks</label>
                    <textarea class="w-full border rounded-lg p-2" rows="2" placeholder="Optional notes..."></textarea>
                </div>
            </div>

            <!-- FILE UPLOAD -->
            <div class="mb-4">
                <label class="font-semibold text-gray-700">Upload Invoice (PDF or Image)</label>
                <input type="file" class="w-full border rounded-lg p-2" accept=".pdf,image/*" />
            </div>

            <!-- ACTION BUTTONS -->
            <div class="flex justify-end space-x-3 border-t pt-4">
                <button type="button" id="cancelModalBtn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300">Cancel</button>
                <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Save Purchase</button>
            </div>
        </form>
    </div>
</div>

<!-- ✅ Simple Modal Toggle Script -->
<script>
    const openModalBtn = document.getElementById('openModalBtn');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const cancelModalBtn = document.getElementById('cancelModalBtn');
    const modal = document.getElementById('purchaseModal');

    openModalBtn.addEventListener('click', () => modal.classList.remove('hidden'));
    closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
    cancelModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
</script>
